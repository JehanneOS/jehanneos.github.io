<html>
	<head>
		<title>Jehanne</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="keywords" content="Jehanne, Plan 9, Open Source, 9P, 9P2000, Inferno, Unix">
		<meta name="description" content="Jehanne, a simple operating system.">
		<!--[if IE]> <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
		<link rel="stylesheet" type="text/css" href="/graphic/screen.css" />
		<style type="text/css">
			.syscall-definition dt { font-family: "Courier New", Courier, monospace; }
		</style>
	</head>
	<body class="page">
		<header>
			<a href="/" id="logo"><span>home</span></a>
			<h1>Jehanne Operating System</h1>
		</header>
		<div class="contents">
			<div class="warning">
				Just like Jehanne, this document is a work in progress.<br/>
				It describes Jehanne as it is designed to be, not how it is right now.
			</div>
			<h1>Motivation</h1>
			<p>
				In the last ten years, the complexity of computing exploded.<br/>
				It would be nice to greet such complexity as a little price for hardware evolution
				and usability improvements but the actual driving forces are not technical.<br/>
				Big software companies fighting to increase or preserve their business shares
				are able to impose different technologies to the market, despite the inherent issues
				of such new technologies. The rise of Javascript as a general purpose language and the
				evolution of browsers into something between complex virtual machines and pretty limited
				operating systems are just recent examples of this trend, but more subtle issues date back
				to the introduction of ioctl and dynamic linking.<br/>
			</p>
			<p>
				Many products address specific issues generated by such inefficient complexity
				(antivirus, container, cloud...), but the price of these business opportunities
				is the number of security holes hidden in the tangle.
			</p>
			<p>
				Jehanne is born as a response to this state of things. It's a simple operating system designed
				for programmers operating in a distributed environment.<br/>
				It doesn't try to replace Linux or to modernize Plan 9: it want to do what Linux and Apache 
				did for the web, proposing better alternatives to what unix, HTTPS and Javascript are today.<br/>
				In other words, Jehanne is part of a much bigger conspiration aiming to <b>replace most of internet with
				a better technology</b>.
			</p>
			<h1>Design</h1>
			<p>
				Just like its well known ancestors, Jehanne can be distributed among several machines acting as 
				CPU servers, file servers and terminals connected by a single file-oriented protocol
				and local name space operations. From the point of view of a systems analyst, it's very similar to
				the <a href="http://doc.cat-v.org/plan_9/4th_edition/papers/9" title="Plan 9 from Bell Labs">4th edition of Plan 9 from Bell Labs</a>.<br/>
				However Jehanne presents a different filesystem hierarchy, a smaller codebase,
				a simpler kernel (counting just 26 syscalls) and a new set of conventions.<br/>
				The venerable 9P2000 has been replaced by FP a new connected file protocol that supports
				atomic operations and streaming. IPC has been simplified and the concept of file has been refined.<br/>
				Several devices have been moved to user space and some good ideas from BSD and Linux have
				inspired others (eg, the select syscall). Finally a modern compiler and a standard C library 
				enable the port of good software from other "unix like" systems.
			</p>
			<h2>Files</h2>
			<p>
				A file in Jehanne is an abstraction that is provided as a node in a tree
				(known as the namespace) and that can be accessed through a small set of syscalls:
				<dl class="syscall-definition">
					<dt>long create(char *file, ulong omode, ulong perm)</dt>
					<dd>creates a file in the tree</dd>
					<dt>long remove(char *file)</dt>
					<dd>removes a file in the tree</dd>
					<dt>long open(char *file, ulong omode)</dt>
					<dd>prepares a file to be accessed by one of the following syscalls by providing a file descriptor</dd>
					<dt>long pread(int fd, void *buf, long nbytes, long offset)</dt>
					<dd>reads from a file descriptor</dd>
					<dt>long pwrite(int fd, void *buf, long nbytes, long offset)</dt>
					<dd>writes to a file descriptor</dd>
<!--
					<dt>long seek(int fd, long n, int type)</dt>
					<dd>changes the current position in an open file</dd>
-->
					<dt>long fd2path(int fd, char *buf, int nbuf)</dt>
					<dd>retrieves the path of a file descriptor</dd>
					<dt>long fstat(int fd, uchar *edir, int nedir)</dt>
					<dd>reads the metadata of a file descriptor</dd>
					<dt>long fwstat(int fd, uchar *edir, int nedir)</dt>
					<dd>modify the metadata of a file descriptor</dd>
<!--
					<dt>long dup(int oldfd, int newfd)</dt>
					<dd>duplicate a file descriptor</dd>
-->
					<dt>long close(int fd)</dt>
					<dd>disable further access to a file descriptor</dd>
				</dl>
				These syscalls provide an uniform interface to access the resources provided
				by the system but the semantic of each operation depends completely on the particular
				file being accessed.
			</p>
			<p>
				For example, Plan 9 programmers will notice that <code>open</code>
				(just like any other Jehanne's syscall) returns a signed <code>long</code> even if the 
				file descriptors are still positive <code>int</code>: the filesystem owning the file
				can refuse to provide a descriptor but provide a meaningful response to the
				calling process as a negative return value.<br/>
				The semantic of such negative number depends entirely on the file being open:
				<code>/dev/now</code> provides the (negated) nanoseconds from the epoch, a userspace filesystem
				can provide a (negated) atomically incremented shared counter and so on.
				
			</p>
			<h2>Namespaces and conventions</h2>
			<p>TO DO</p>
			<h2>Processes and IPC</h2>
			<p>TO DO</p>
			<h2>C Libraries</h2>
			<p>TO DO</p>
			<h1>Implementation</h1>
			<h2>FP, the File Protocol</h2>
			<p>TO DO</p>
			<h2>Software distribution</h2>
			<p>TO DO</p>
		</div>
	</body>
</html>

